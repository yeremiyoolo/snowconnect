// 1. Generador del Cliente
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"  // <--- ¡ESTA LÍNEA ES OBLIGATORIA!
  url      = env("snowconnect_PRISMA_DATABASE_URL")
  directUrl = env("snowconnect_POSTGRES_URL")
}

// 3. Modelos de la Base de Datos

model User {
  id        String   @id @default(cuid())
  name      String?
  email     String   @unique
  password  String
  role      String   @default("USER") // "ADMIN" o "USER"
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relaciones
  productos Producto[] // Un usuario registra muchos productos
  ventas    Venta[]    // Un usuario realiza muchas ventas
}

model Producto {
  id             String   @id @default(cuid())
  imei           String   @unique
  marca          String
  modelo         String
  color          String
  almacenamiento String
  ram            String
  estado         String   @default("DISPONIBLE") // "DISPONIBLE", "VENDIDO"
  
  // Finanzas del producto
  precioCompra   Float
  precioVenta    Float
  margen         Float
  
  descripcion    String?
  fotosJson      String?  @db.Text // Guardamos array de fotos como texto JSON
  
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  fechaVenta     DateTime?

  // Relación con quien lo registró
  userId         String
  user           User     @relation(fields: [userId], references: [id])

  // Relación con la venta (Un producto solo se vende una vez)
  venta          Venta?
}

model Venta {
  id          String   @id @default(cuid())
  cliente     String?
  notas       String?
  
  // Datos financieros congelados al momento de la venta
  precioVenta Float
  costo       Float
  margen      Float
  
  createdAt   DateTime @default(now())

  // Relación con el producto vendido
  productoId  String   @unique
  producto    Producto @relation(fields: [productoId], references: [id])

  // Relación con el vendedor (Usuario)
  userId      String
  user        User     @relation(fields: [userId], references: [id])
}